---
- name: create key for identify server
  include_tasks: create_key_without_passphrase.yml
  vars:
    path_key: '{{ path_file_secret_key_server }}'

- name: set group as "ssl-cert" for enable SSL on Postgres
  file:
    path: '{{ path_file_secret_key_server }}'
    state: touch
    owner: root
    group: 103
    mode: 0640

- name: create certificate signing request
  command: >
    openssl req -new
    -key {{ path_file_secret_key_server }}
    -out {{ path_file_certificate_server_request }} -sha256 -subj
    '/C={{ csr_country_name }}/ST={{ csr_state_or_province_name }}/L={{ csr_locality_name }}/O={{ csr_organization_name }}/CN=*.{{ roles_common_domain_name }}'
  args:
    creates: '{{ path_file_certificate_server_request }}'
